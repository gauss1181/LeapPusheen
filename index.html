<!DOCTYPE html>
<html>
  <head>
    <title>Leap Pusheen</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <script src="http://js.leapmotion.com/leap-0.6.2.js"></script>
    <script src="http://js.leapmotion.com/leap-0.6.2.min.js"></script>
    <script src="http://js.leapmotion.com/leap-plugins-0.1.6.js"></script>
    <script src="http://js.leapmotion.com/leap-plugins-0.1.6.min.js"></script>
    <script type="text/javascript" src="simpleGame.js"></script>
    <script type="text/javascript">
    var cats = {};
    var scene;
    var floor;
    var yarns;
    var num_yarns = Math.ceil(Math.random() * 10);

    var Cat = function() {
      var cat = this;
      var img = document.createElement('img');
      img.src = 'http://fc00.deviantart.net/fs71/f/2013/177/f/5/pusheen_the_cat_png_22_by_13taylorswiftlover13-d6apppf.png';
      img.style.position = 'absolute';
      img.onload = function () {
        cat.setTransform([window.innerWidth/2,window.innerHeight/2], 0);
        document.body.appendChild(img);
      };
      
      cat.setTransform = function(position, rotation) {

        img.style.left = position[0] - img.width  / 2 + 'px';
        img.style.top  = position[1] - img.height / 2 + 'px';

        img.style.transform = 'rotate(' + -rotation + 'rad)';
      
        img.style.webkitTransform = img.style.MozTransform = img.style.msTransform =
        img.style.OTransform = img.style.transform;

      };

    };

    function Yarn() {
      tYarn = new Sprite(scene, "yarn.png", 50, 50);

      tYarn.reset = function() {
        this.setDY((Math.random() * 10) - 5);
        this.setDX((Math.random() * 10) + 5);
        newY = Math.random() * scene.height;
        this.setPosition(50, newY);
      };

      tYarn.checkBounds = function() {
        if (this.x > scene.width) {
          this.reset();
        }
      };

      tYarn.reset();

      return tYarn;
    }

    function makeYarns() {
      yarns = new Array(num_yarns);
      for (i = 0; i < num_yarns; i++) {
        yarns[i] = new Yarn();
      }
    }

    function updateYarns() {
      for (i = 0; i < num_yarns; i++) {
        yarns[i].update();
      }
    }

    function Floor() {
      tFloor = new Sprite(scene, "floor.jpg", 2200, 700);
      tFloor.setDX(-10);
      tFloor.setDY(0);
      tFloor.setPosition(1100, 350);

      tFloor.checkBounds = function() {
        // repeat floor background for side scroller
        if (this.x < 0) {
          this.setPosition(1100, 350);
        }
      };

      return tFloor;
    }

    function init() {
      scene = new Scene();
      scene.setSize(1100, 700);
      makeYarns();
      floor = new Floor();
      scene.start();
      Leap.loop(function(frame) {

        frame.hands.forEach(function(hand, index) {
          
          var cat = ( cats[index] || (cats[index] = new Cat()) );    
          cat.setTransform(hand.screenPosition(), hand.roll());
          
        });
        
      }).use('screenPosition', {scale: 0.25});
      cats[0] = new Cat();
      Leap.loopController.setBackground(true);
    }

    function update() {
      scene.clear();
      floor.update();
      updateYarns();
    }

    //cats[0] = new Cat();

    // This allows us to move the cat even whilst in an iFrame.
    //Leap.loopController.setBackground(true);
    </script>
  </head>
  <body onload = "init()">
  </body>
</html>
